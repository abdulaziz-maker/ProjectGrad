{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="text-center mx-auto">ğŸ“Š Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</h2>
    </div>

    <!-- âœ… Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
    <div id="stats">
        <p>â³ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...</p>
    </div>

    <style>
        canvas {
            width: 280px !important;
            height: 280px !important;
            margin: auto;
        }
    </style>

    <div class="row mt-5">
        <div class="col-md-6 text-center">
            <h5>ğŸ‘¥ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h5>
            <canvas id="usersChart"></canvas>
        </div>
        <div class="col-md-6 text-center">
            <h5>ğŸ“„ Ø­Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…Ø§Øª</h5>
            <canvas id="applicationsChart"></canvas>
        </div>
    </div>
</div>

<!-- âœ… JavaScript Ù„Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙˆØ§Ù„Ø±Ø³ÙˆÙ… -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    function renderCharts(userStats, appStats){
        // ğŸ”¥ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        new Chart(document.getElementById('usersChart'), {
            type: 'pie',
            data: {
                labels: ['Ø¨Ø§Ø­Ø«ÙŠÙ† Ø¹Ù† Ø¹Ù…Ù„', 'Ø£ØµØ­Ø§Ø¨ Ø¹Ù…Ù„'],
                datasets: [{
                    data: [userStats.job_seekers, userStats.employers],
                    backgroundColor: ['#36A2EB', '#FFCE56']
                }]
            },
            options: {
                plugins: {
                    legend: {
                        labels: {
                            color: '#FFFFFF',  // âœ… Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø£Ø¨ÙŠØ¶
                            font: {
                                size: 14
                            }
                        }
                    }
                }
            }
        });

        // ğŸ”¥ ØªÙ‚Ø¯ÙŠÙ…Ø§Øª
        new Chart(document.getElementById('applicationsChart'), {
            type: 'doughnut',
            data: {
                labels: ['Ù…Ù‚Ø¨ÙˆÙ„Ø©', 'Ù…Ø±ÙÙˆØ¶Ø©', 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©'],
                datasets: [{
                    data: [appStats.accepted, appStats.rejected, appStats.pending],
                    backgroundColor: ['#4BC0C0', '#FF6384', '#FF9F40']
                }]
            },
            options: {
                plugins: {
                    legend: {
                        labels: {
                            color: '#FFFFFF',  // âœ… Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø£Ø¨ÙŠØ¶
                            font: {
                                size: 14
                            }
                        }
                    }
                }
            }
        });
    }

    // âœ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙˆØ§Ù„Ø±Ø³ÙˆÙ…
    function loadStats(){
        fetch('/admin-stats-json')
        .then(response => response.json())
        .then(data => {
            document.getElementById('stats').innerHTML = data.html;
            renderCharts(data.userStats, data.appStats);
        });
    }

    loadStats();
    setInterval(loadStats, 5000);
</script>
{% endblock %}
